# Система подтверждения изменений настроек пользователя

Проект реализует систему подтверждения изменения настроек пользователя на Laravel 10 и Vue 3 (Options API).
(Из коробки установлен Composition API)

## Содержание

- [Требования](#требования)
- [Установка](#установка)
- [Обзор архитектуры](#обзор-архитектуры)
    - [Слои и абстракции](#слои-и-абстракции)
    - [Таблицы базы данных](#таблицы-базы-данных)
    - [Связи моделей](#связи-моделей)
- [Использование](#использование)

## Требования

- PHP 8.1 или выше
- Laravel 10
- Vue 3 (Options API)
- Vite
- Bootstrap 5

## Установка

1. **Клонируйте репозиторий:**
2. **Установите зависимости PHP:**
```bash 
composer install
```
3. **Установите зависимости NPM:**
```bash 
npm install
```
4. **Настройте переменные окружения:**

    - Скопируйте `.env.example` в `.env` и настройте параметры подключения к базе данных.

5. **Запустите миграции:**
```bash 
php artisan migrate
```
6. **Соберите ассеты:**
```bash 
npm run dev
```
7. **Запустите сервер разработки:**
```bash 
php artisan serve
```
## Обзор архитектуры

### Слои и абстракции

Система разделена на несколько слоев и выделены соответствующие паттерны:

1. **Контроллеры:** Обрабатывают HTTP-запросы и ответы.
2. **Запросы:** Валидация запросов.
3. **Сервисный слой:** Содержат бизнес-логику, в частности `SettingConfirmationService`.
4. **Репозитории:** Абстрагируют работу с базой данных.
5. **Модели:** Представляют сущности базы данных.
6. **Enum:** Определяют постоянные значения, такие как методы подтверждения.
7. **Фабрика:** Реализует выбор метода подтверждения.

Реализован единый интерфейс для методов отправки. 
Конечно, лучше всего обрабатывать отправку сообщений с помощью очередей (Jobs), но целью тестового было показать умение проектирование систем

### Таблицы базы данных

1. **users:** Стандартная таблица пользователей Laravel.
2. **user_settings:** Хранит настройки пользователей.
    - `id`
    - `user_id`
    - `key` (ключ настройки)
    - `value` (значение настройки)
3. **setting_confirmations:** Хранит запросы на подтверждение изменений настроек.
    - `id`
    - `user_id`
    - `key` (ключ настройки для изменения)
    - `value` (предлагаемое новое значение)
    - `confirmation_code` (код, отправленный пользователю)
    - `method` (метод подтверждения: email, sms, telegram)
    - `expires_at` (время истечения кода)
    - `confirmed_at` (время подтверждения кода)

### Связи моделей

- **User** (один) - **UserSetting** (многие)
- **User** (один) - **SettingConfirmation** (многие)

## Использование

1. **Зарегистрируйтесь или войдите** в систему как пользователь (предварительно перейдя на http://localhost:8000).

2. **Перейдите** в профиль, найдите раздел с изменением настроек.

3. **Заполните** форму, указав ключ настройки, новое значение и выберите предпочтительный метод подтверждения.

4. **Отправьте** форму для запроса изменения настройки.

5. **Проверьте** код.

6. **Введите** код подтверждения (должен отображаться в интерфейсе).
